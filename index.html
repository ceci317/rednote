<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Visual Clone Pro - å¾®ä¿¡é€‚é…ç‰ˆ</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Sans+SC:wght@300;400;700;900&family=Noto+Serif+SC:wght@700&family=Zhi+Mang+Xing&display=swap" rel="stylesheet">

    <style>
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }

        .xhs-card {
            width: 450px;
            height: 600px;
            overflow: hidden;
            position: relative;
            flex-shrink: 0;
            background-color: white;
            transform-origin: top center;
        }

        .pattern-grid {
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .pattern-paper {
            background-color: #fdfbf7;
            background-image: linear-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 100% 24px;
        }
        
        .font-sans-sc { font-family: 'Noto Sans SC', sans-serif; }
        .font-serif-sc { font-family: 'Noto Serif SC', serif; }
        .font-calligraphy { font-family: 'Ma Shan Zheng', cursive; }
        .font-handwriting { font-family: 'Zhi Mang Xing', cursive; }

        @media (max-width: 768px) {
            .mobile-editor-drawer {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                height: 50vh;
                background: white;
                transform: translateY(100%);
                transition: transform 0.3s ease;
                z-index: 50;
                border-top-left-radius: 16px;
                border-top-right-radius: 16px;
                box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            }
            .mobile-editor-drawer.active {
                transform: translateY(0);
            }
            .preview-scale-wrapper {
                transform: scale(0.75);
                margin-top: -60px;
                margin-bottom: -60px;
            }
        }
    </style>
</head>
<body class="bg-gray-100 h-screen flex flex-col text-slate-800 font-sans overflow-hidden">

    <nav class="h-14 bg-white border-b border-gray-200 flex items-center justify-between px-4 shadow-sm z-20 flex-shrink-0">
        <div class="flex items-center gap-2">
            <div class="bg-blue-600 text-white p-1 rounded">
                <i data-lucide="scan-face" class="w-5 h-5"></i>
            </div>
            <h1 class="font-bold text-sm tracking-tight hidden md:block">Visual Clone <span class="text-blue-600 text-xs uppercase bg-blue-50 px-1 py-0.5 rounded ml-1">Pro</span></h1>
            <h1 class="font-bold text-sm md:hidden">V-Clone</h1>
        </div>
        
        <div class="flex items-center gap-2">
            <button onclick="toggleMobileEditor()" class="md:hidden flex items-center gap-1 bg-gray-100 text-gray-700 px-3 py-1.5 rounded text-xs font-medium">
                <i data-lucide="edit-3" class="w-3 h-3"></i> ç¼–è¾‘
            </button>
            <button onclick="handleExport()" id="downloadBtn" class="flex items-center gap-2 bg-slate-900 hover:bg-slate-800 text-white px-3 py-1.5 rounded text-xs font-medium transition-colors shadow-sm">
                <i data-lucide="image" class="w-3 h-3"></i>
                <span id="exportText">ç”Ÿæˆå›¾ç‰‡</span>
            </button>
        </div>
    </nav>

    <div class="flex-1 flex overflow-hidden relative">
        <aside id="editorPanel" class="mobile-editor-drawer md:relative md:w-80 lg:w-96 md:h-full md:transform-none md:border-r border-gray-200 flex flex-col z-40 bg-white">
            <div class="md:hidden w-full flex justify-center pt-3 pb-1" onclick="toggleMobileEditor()">
                <div class="w-10 h-1 bg-gray-300 rounded-full"></div>
            </div>

            <div class="flex-1 overflow-y-auto p-5 space-y-6 pb-20 md:pb-5">
                <div>
                    <h3 class="flex items-center gap-2 text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">
                        <i data-lucide="palette" class="w-3 h-3"></i> é£æ ¼é¢„è®¾
                    </h3>
                    <div class="grid grid-cols-2 gap-2" id="styleSelector"></div>
                </div>

                <div>
                    <h3 class="flex items-center gap-2 text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">
                        <i data-lucide="type" class="w-3 h-3"></i> å†…å®¹ç¼–è¾‘
                    </h3>
                    <textarea id="contentInput" class="w-full h-32 p-3 border border-gray-200 rounded-lg bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:outline-none text-sm leading-relaxed resize-none placeholder-gray-400"></textarea>
                </div>

                <div>
                     <h3 class="flex items-center gap-2 text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">
                        <i data-lucide="image" class="w-3 h-3"></i> å°é¢é…å›¾
                    </h3>
                    <div class="relative group">
                        <input type="file" id="imageInput" accept="image/*" class="hidden" onchange="handleImageUpload(this)">
                        <div id="imagePreviewArea" class="hidden relative w-full h-32 rounded-lg overflow-hidden border border-gray-200 mb-2">
                            <img id="imagePreview" class="w-full h-full object-cover">
                            <button onclick="removeImage()" class="absolute top-1 right-1 bg-black/50 text-white p-1 rounded-full"><i data-lucide="x" class="w-3 h-3"></i></button>
                        </div>
                        <button onclick="document.getElementById('imageInput').click()" id="uploadBtn" class="w-full border-2 border-dashed border-gray-200 rounded-lg p-3 flex items-center justify-center gap-2 text-gray-500 text-sm">
                            <i data-lucide="upload-cloud" class="w-4 h-4"></i> ä¸Šä¼ å°é¢
                        </button>
                    </div>
                </div>

                <div class="bg-gray-50 p-3 rounded-lg border border-gray-100 space-y-3">
                    <h3 class="flex items-center gap-2 text-xs font-bold text-gray-400 uppercase tracking-wider">
                        <i data-lucide="sliders" class="w-3 h-3"></i> å¤–è§‚å¾®è°ƒ
                    </h3>
                    
                    <div class="flex items-center gap-2">
                        <span class="text-xs text-gray-500 w-8">å­—ä½“</span>
                        <select id="fontSelect" class="flex-1 text-xs border border-gray-200 rounded p-1.5 bg-white" onchange="renderApp()">
                            <option value="font-sans-sc">æ€æºé»‘ä½“</option>
                            <option value="font-serif-sc">æ€æºå®‹ä½“</option>
                            <option value="font-calligraphy">é©¬å–„æ”¿æ¯›ç¬”</option>
                            <option value="font-handwriting">å¿—è½è¡Œä¹¦</option>
                        </select>
                    </div>

                    <div class="flex items-center gap-2">
                        <span class="text-xs text-gray-500 w-8">å¤§å°</span>
                        <input type="range" id="fontSizeRange" min="0.8" max="1.3" step="0.05" value="1" class="flex-1 h-1 bg-gray-300 rounded-lg" oninput="renderApp()">
                    </div>

                    <div class="flex items-center gap-4">
                        <div class="flex items-center gap-2 flex-1">
                            <span class="text-xs text-gray-500">èƒŒæ™¯</span>
                            <div class="relative w-full h-6 rounded border border-gray-200 overflow-hidden">
                                <input type="color" id="bgColorPicker" class="opacity-0 absolute inset-0 w-full h-full cursor-pointer" oninput="updateColorPreview('bg', this.value); renderApp()">
                                <div id="bgColorPreview" class="w-full h-full bg-white pointer-events-none"></div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2 flex-1">
                            <span class="text-xs text-gray-500">æ–‡å­—</span>
                            <div class="relative w-full h-6 rounded border border-gray-200 overflow-hidden">
                                <input type="color" id="textColorPicker" class="opacity-0 absolute inset-0 w-full h-full cursor-pointer" oninput="updateColorPreview('text', this.value); renderApp()">
                                <div id="textColorPreview" class="w-full h-full bg-gray-800 pointer-events-none"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3 pt-2">
                    <div>
                        <label class="text-xs text-gray-500 mb-1 block">æ—¥æœŸ</label>
                        <input type="text" id="dateInput" value="NO.001" class="w-full text-xs border border-gray-200 rounded p-2" oninput="renderApp()">
                    </div>
                    <div>
                        <label class="text-xs text-gray-500 mb-1 block">ç½²å</label>
                        <input type="text" id="authorInput" value="@VisualClone" class="w-full text-xs border border-gray-200 rounded p-2" oninput="renderApp()">
                    </div>
                </div>
            </div>
        </aside>

        <div id="drawerOverlay" onclick="toggleMobileEditor()" class="fixed inset-0 bg-black/20 z-30 hidden md:hidden transition-opacity"></div>

        <main class="flex-1 bg-gray-200 relative overflow-y-auto p-4 md:p-8 flex flex-col items-center gap-4 scroll-smooth" id="previewContainer">
        </main>
    </div>

    <div id="measureContainer" class="fixed top-0 left-0 pointer-events-none opacity-0 z-[-1]"></div>

    <div id="exportModal" class="fixed inset-0 z-50 bg-black/90 hidden flex flex-col items-center justify-center p-4">
        <div class="w-full max-w-md bg-transparent flex flex-col max-h-[90vh]">
            <div class="flex justify-between items-center text-white mb-2 px-2">
                <span class="text-sm font-bold">ğŸ‘‡ é•¿æŒ‰å›¾ç‰‡ä¿å­˜åˆ°ç›¸å†Œ</span>
                <button onclick="closeExportModal()" class="p-1 hover:bg-white/20 rounded"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>
            <div id="exportImagesContainer" class="overflow-y-auto flex-1 space-y-4 rounded-lg text-center">
            </div>
        </div>
    </div>

<script>
    const defaultText = `å¦‚ä½•å®‰è£…åˆ°å¾®ä¿¡å°ç¨‹åºï¼Ÿ\nVisual Clone Pro\n---\n1. å‡†å¤‡å·¥ä½œ\nå¾®ä¿¡å°ç¨‹åºä¸æ”¯æŒç›´æ¥è¿è¡Œ HTML æ–‡ä»¶ã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨ <web-view> ç»„ä»¶ã€‚\n\n2. æ“ä½œæ­¥éª¤\n- éƒ¨ç½²æœ¬ä»£ç ï¼šå°†æ­¤ HTML æ–‡ä»¶éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼Œè·å– https é“¾æ¥ã€‚\n- å°ç¨‹åºåå°ï¼šç™»å½•å¾®ä¿¡å…¬ä¼—å¹³å°ï¼Œåœ¨ä¸šåŠ¡åŸŸåä¸­é…ç½®ä½ çš„åŸŸåã€‚\n- å¼€å‘è€…å·¥å…·ï¼šæ–°å»ºå°ç¨‹åºé¡¹ç›®ï¼Œåœ¨ pages/index/index.wxml ä¸­å†™å…¥ï¼š\n<web-view src="ä½ çš„httpsé“¾æ¥"></web-view>\n\n3. ä½“éªŒä¼˜åŒ–\n- ç‚¹å‡»å³ä¸Šè§’"ç”Ÿæˆå›¾ç‰‡"\n- åœ¨å¼¹çª—ä¸­é•¿æŒ‰ä¿å­˜\n- å‘é€åˆ°æ‰‹æœºç›¸å†Œ\n\nğŸ‰ å®Œæˆï¼`;

    const styles = {
        minimal: { id: 'minimal', name: 'æç®€é£', desc: 'å¹²å‡€é«˜çº§', class: 'bg-white', titleClass: 'text-3xl font-bold mb-4 tracking-tight leading-tight', bodyClass: 'text-lg leading-8 font-light', defaultFont: 'font-sans-sc', defaultColor: '#1e293b', defaultBg: '#ffffff' },
        poster: { id: 'poster', name: 'å¤§å­—æŠ¥', desc: 'å†²å‡»åŠ›å¼º', class: 'bg-[#ff3b30]', titleClass: 'text-4xl font-black mb-4 uppercase tracking-tighter leading-none border-b-4 border-current pb-4', bodyClass: 'text-xl font-bold leading-normal', defaultFont: 'font-sans-sc', defaultColor: '#ffffff', defaultBg: '#ff3b30' },
        memo: { id: 'memo', name: 'å¤‡å¿˜å½•', desc: 'äº²åˆ‡åˆ—è¡¨', class: 'pattern-paper', titleClass: 'text-2xl font-bold mb-4 px-2', bodyClass: 'text-lg leading-[3rem] font-medium px-2', defaultFont: 'font-sans-sc', defaultColor: '#334155', defaultBg: '#fbfbfd' },
        journal: { id: 'journal', name: 'æ‰‹å¸é£', desc: 'å¯çˆ±æ‹¼è´´', class: 'pattern-grid', titleClass: 'text-4xl mb-6 transform -rotate-2', bodyClass: 'text-lg leading-loose', defaultFont: 'font-handwriting', defaultColor: '#57534e', defaultBg: '#fffdf5' },
        drygoods: { id: 'drygoods', name: 'ç¡¬æ ¸å¹²è´§', desc: 'æ·±è‰²ä¸“ä¸š', class: 'bg-[#0f172a]', titleClass: 'text-3xl font-bold mb-6 border-l-4 border-blue-500 pl-4', bodyClass: 'text-base leading-7 tracking-wide', defaultFont: 'font-sans-sc', defaultColor: '#e2e8f0', defaultBg: '#0f172a' }
    };

    let currentStyle = 'minimal';
    let coverImageData = null;

    document.addEventListener('DOMContentLoaded', () => {
        lucide.createIcons();
        initUI();
        resetCustomControls(styles[currentStyle]);
        renderApp();
    });

    function initUI() {
        document.getElementById('contentInput').value = defaultText;
        document.getElementById('contentInput').addEventListener('input', debounce(renderApp, 300));
        const styleContainer = document.getElementById('styleSelector');
        Object.values(styles).forEach(style => {
            const btn = document.createElement('button');
            btn.className = `p-2 rounded-lg border text-left transition-all hover:shadow-sm flex flex-col justify-between h-14 ${currentStyle === style.id ? 'border-blue-500 bg-blue-50 ring-1 ring-blue-500' : 'border-gray-200 bg-white'}`;
            btn.innerHTML = `<span class="font-bold text-xs ${currentStyle === style.id ? 'text-blue-700' : 'text-gray-700'}">${style.name}</span>`;
            btn.onclick = () => {
                currentStyle = style.id;
                Array.from(styleContainer.children).forEach(c => c.className = c.className.replace('border-blue-500 bg-blue-50 ring-1 ring-blue-500', 'border-gray-200 bg-white'));
                btn.className = btn.className.replace('border-gray-200 bg-white', 'border-blue-500 bg-blue-50 ring-1 ring-blue-500');
                resetCustomControls(styles[currentStyle]);
                renderApp();
            };
            styleContainer.appendChild(btn);
        });
    }

    function parseInput() {
        const lines = document.getElementById('contentInput').value.split('\n').filter(l => l.trim());
        return { title: lines[0] || 'æ— æ ‡é¢˜', paragraphs: lines.slice(1) };
    }

    function renderApp() {
        const container = document.getElementById('previewContainer');
        container.innerHTML = '';
        const data = parseInput();
        const styleObj = styles[currentStyle];
        const customFont = document.getElementById('fontSelect').value;
        const fontScale = parseFloat(document.getElementById('fontSizeRange').value);
        const customBg = document.getElementById('bgColorPicker').value;
        const customColor = document.getElementById('textColorPicker').value;
        const dateText = document.getElementById('dateInput').value;
        const authorText = document.getElementById('authorInput').value;
        const measureBox = document.getElementById('measureContainer');
        measureBox.className = `xhs-card p-8 fixed top-0 left-0 z-[-1] opacity-0 ${styleObj.class} ${customFont}`;
        measureBox.style.backgroundColor = customBg; 
        measureBox.style.color = customColor;
        const buildTitle = () => `<h1 class="${styleObj.titleClass}" style="font-size: ${2.25 * fontScale}rem; line-height: 1.2;">${data.title}</h1>`;
        const buildMeta = () => dateText ? `<div class="text-xs font-mono opacity-60 mb-4 uppercase tracking-widest border-b border-current/20 pb-2 inline-block">${dateText}</div>` : '';
        const buildImage = () => coverImageData ? `<div class="w-[calc(100%+4rem)] -ml-8 -mt-8 mb-6 h-64 overflow-hidden relative"><img src="${coverImageData}" class="w-full h-full object-cover"></div>` : '';
        const buildPara = (text) => {
            const isList = text.startsWith('-') || text.match(/^\d+\./);
            return `<div class="mb-2 opacity-90 ${styleObj.bodyClass} ${isList ? 'pl-2' : ''}" style="font-size: ${1.125 * fontScale}rem;">${text}</div>`;
        };
        let cards = [];
        const MAX_HEIGHT = 520;
        let currentPageContent = [];
        measureBox.innerHTML = (coverImageData ? buildImage() : '') + buildMeta() + buildTitle();
        currentPageContent.push(measureBox.innerHTML);
        data.paragraphs.forEach(para => {
            const pHTML = buildPara(para);
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = pHTML;
            measureBox.appendChild(tempDiv);
            if (measureBox.offsetHeight > MAX_HEIGHT) {
                cards.push(currentPageContent);
                currentPageContent = [pHTML];
                measureBox.innerHTML = pHTML;
            } else {
                currentPageContent.push(pHTML);
            }
        });
        if (currentPageContent.length > 0) cards.push(currentPageContent);
        cards.forEach((contentArr, index) => {
            const cardWrapper = document.createElement('div');
            cardWrapper.className = `xhs-card flex flex-col p-8 shadow-xl relative group ${styleObj.class} ${customFont} preview-scale-wrapper`;
            cardWrapper.style.backgroundColor = customBg;
            cardWrapper.style.color = customColor;
            if (styleObj.id === 'minimal') {
                const bar = document.createElement('div');
                bar.className = 'absolute bottom-0 left-0 w-full h-1.5 opacity-50';
                bar.style.background = `linear-gradient(to right, ${customColor}, transparent)`;
                cardWrapper.appendChild(bar);
            }
            const inner = document.createElement('div');
            inner.className = 'flex-1 relative z-10';
            inner.innerHTML = contentArr.join('');
            cardWrapper.appendChild(inner);
            const footer = document.createElement('div');
            footer.className = 'mt-auto pt-4 flex justify-between items-center text-[10px] opacity-40 font-mono tracking-widest border-t border-current/10 relative z-10';
            footer.innerHTML = `<span>${index + 1} / ${cards.length}</span><span>${authorText}</span>`;
            cardWrapper.appendChild(footer);
            container.appendChild(cardWrapper);
        });
        lucide.createIcons();
    }

    function handleExport() {
        const cards = document.querySelectorAll('.xhs-card');
        const modal = document.getElementById('exportModal');
        const container = document.getElementById('exportImagesContainer');
        const btn = document.getElementById('downloadBtn');
        const originalText = document.getElementById('exportText').innerText;
        document.getElementById('exportText').innerText = "ç”Ÿæˆä¸­...";
        btn.disabled = true;
        container.innerHTML = ''; 
        cards.forEach(c => c.classList.remove('preview-scale-wrapper'));
        const promises = Array.from(cards).map(async (card) => {
            const canvas = await html2canvas(card, { scale: 2, useCORS: true, backgroundColor: null });
            return canvas.toDataURL('image/png');
        });
        Promise.all(promises).then(images => {
            images.forEach(imgData => {
                const img = document.createElement('img');
                img.src = imgData;
                img.className = 'w-full max-w-[300px] mx-auto rounded shadow-lg border border-gray-700';
                container.appendChild(img);
            });
            modal.classList.remove('hidden');
        }).catch(err => {
            console.error(err);
            alert('ç”Ÿæˆå¤±è´¥');
        }).finally(() => {
            cards.forEach(c => c.classList.add('preview-scale-wrapper'));
            document.getElementById('exportText').innerText = originalText;
            btn.disabled = false;
        });
    }

    function closeExportModal() {
        document.getElementById('exportModal').classList.add('hidden');
    }

    function resetCustomControls(style) {
        document.getElementById('fontSelect').value = style.defaultFont;
        updateColorPreview('bg', style.defaultBg);
        updateColorPreview('text', style.defaultColor);
    }
    
    function updateColorPreview(type, val) {
        const el = document.getElementById(type === 'bg' ? 'bgColorPicker' : 'textColorPicker');
        const prev = document.getElementById(type === 'bg' ? 'bgColorPreview' : 'textColorPreview');
        el.value = val;
        prev.style.backgroundColor = val;
    }

    function handleImageUpload(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => {
                coverImageData = e.target.result;
                document.getElementById('imagePreview').src = coverImageData;
                document.getElementById('imagePreviewArea').classList.remove('hidden');
                document.getElementById('uploadBtn').classList.add('hidden');
                renderApp();
            };
            reader.readAsDataURL(input.files[0]);
        }
    }
    
    function removeImage() {
        coverImageData = null;
        document.getElementById('imageInput').value = '';
        document.getElementById('imagePreviewArea').classList.add('hidden');
        document.getElementById('uploadBtn').classList.remove('hidden');
        renderApp();
    }

    function toggleMobileEditor() {
        const drawer = document.getElementById('editorPanel');
        const overlay = document.getElementById('drawerOverlay');
        drawer.classList.toggle('active');
        if (drawer.classList.contains('active')) {
            overlay.classList.remove('hidden');
        } else {
            overlay.classList.add('hidden');
        }
    }

    function debounce(func, wait) {
        let timeout;
        return function(...args) {
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(this, args), wait);
        };
    }
</script>
</body>
</html>
